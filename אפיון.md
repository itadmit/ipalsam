להלן אפיון מסודר ומקצועי למערכת ipalsam לניהול ציוד בבסיס צבאי, עם דגש על המפקדה, עבודה לפי מחלקות, השאלות/החזרות עם חתימה ותיעוד, ועמידה בעקרונות Next.js "מהיר כמו PHP" (Server Components 80%+, Server Actions, קאשינג, Optimistic UI נקודתי).

---
## ✅ סטטוס מימוש - עודכן 22/01/2026

| רכיב | סטטוס |
|------|-------|
| הקמת פרויקט Next.js | ✅ הושלם |
| מסד נתונים (Schema) | ✅ הושלם |
| מערכת אימות (Auth) | ✅ הושלם |
| עמוד התחברות | ✅ הושלם |
| דשבורד מפקדה | ✅ הושלם |
| דשבורד מחלקה | ✅ הושלם |
| דשבורד חייל | ✅ הושלם |
| ניהול מחלקות | ✅ הושלם |
| ניהול משתמשים | ✅ הושלם |
| ניהול ציוד | ✅ הושלם |
| מערכת בקשות | ✅ הושלם |
| Server Actions | ✅ הושלם |
| אזור סופר אדמין | ✅ הושלם |
| Seed נתונים | ✅ הושלם |

---

1) מטרת המערכת (Vision)

מערכת לניהול ציוד בבסיס בזמן אמת, לפי מחלקות, כך שבסוף תעסוקה/קיפול בסיס:

יודעים כמה היה בתחילת התקופה (Snapshot פתיחה).

יודעים איפה כל פריט נמצא ומי מחזיק בו.

מנהלים בקשות / השאלות / החזרות עם חתימת חייל על כל גריעה/הקצאה.

מסיימים עם אפס אבדות או לפחות עם דוח חריגים מלא (מי, מה, מתי, למה).

2) משתמשים, זיהוי והרשאות (RBAC)
2.1 סוגי משתמשים

סופר אדמין (יוגב אביטן)

ניהול בסיסים, מחלקות, משתמשים, הרשאות, קטגוריות, מדיניות שעות פעילות, תצורות מערכת, דוחות על.

מפקד מחלקה (למשל: ולרי – קשר)

רואה ומנהל רק ציוד/קטגוריות של המחלקה שלו.

מאשר/דוחה בקשות.

מבצע מסירה (השאלה) והחזרה עם חתימה.

מפיק דוחות מחלקתיים.

חייל (מבקש/שואל ציוד)

יכול לראות קטלוג ציוד המותר לו (לפי מדיניות).

יוצר בקשה להשאלה/שימוש.

חותם על קבלה והחזרה.

רל״ש/שלישות/מפקדה (אופציונלי, אם רוצים)

תצוגת סטטוס רוחבית: תמונת מצב כללית, חריגים, ציוד קריטי.

אפשר להוסיף בהמשך “תפקידים” (Role Templates) כמו: לוגיסטיקה, נשק, רכב וכו׳.

2.2 זיהוי משתמש

טלפון משמש כ-Username (לא “מספר אישי”).

יש גם: שם פרטי, שם משפחה, אימייל (אופציונלי, לתזכורות).

סיסמה ברירת מחדל: הטלפון של החייל (ובהתחברות ראשונה: חובה שינוי).

אימות דו-שלבי (אופציונלי): קוד חד-פעמי ב-SMS/אימייל (אם מותר ארגונית).

2.3 הרשאות בסיסיות (דוגמא)

חייל: request.create, request.view_own, signature.sign_own

מפקד מחלקה: inventory.read_dept, inventory.manage_dept, request.approve_dept, handover.execute_dept

סופר אדמין: *

3) מודל נתונים (Entities) – מה מנהלים בפועל
3.1 בסיס/תקופה

Base: שם בסיס, סטטוס (פעיל/קיפול), פרטי מפקדה, תאריך פתיחה/סגירה.

Operational Period (אופציונלי): “תעסוקה ינואר 2026” כדי להפריד בין תקופות.

3.2 מחלקות

מחלקה: שם (קשר / אפסנאות / לוגיסטיקה / נשק / רכב / שלישות + עוד), מנהל מחלקה, שעות פעילות, מדיניות הזמנה.

3.3 ציוד

יש 2 רמות (כדי לתמוך גם בכמות וגם בפריטים סריאליים):

ItemType (סוג ציוד) – לדוגמה: “מכשיר קשר דגם X”
שדות:

שם מוצר

מק״ט/מס״ב/צ׳

קטגוריה/מחלקה

הערות

האם ציוד “כמותי” (20 יח׳) או “סריאלי” (כל יחידה עם מספר סידורי)

Stock / Units

אם כמותי: quantity_total, quantity_available, quantity_in_use

אם סריאלי: טבלת ItemUnit לכל יחידה עם Serial/AssetTag + סטטוס

3.4 תנועות (היסטוריה / Audit)

כל פעולה נרשמת כ-Movement / Event:

כניסה למלאי (קליטה)

הקצאה/השאלה

החזרה

העברה בין מחלקות

גריעה/אובדן/השמדה (רק בהרשאה גבוהה + סיבה + אישור)

לכל Movement: מי ביצע, מי קיבל, מתי, כמות/יחידה, הערה, חתימה/אישור.

3.5 בקשות (Requests)

חייל יוצר בקשה להשאלה:

ציוד מבוקש (פריט/כמות)

מחלקה/קטגוריה

תאריך ושעת איסוף (אם לא מיידי)

דחיפות: מיידי / מתוזמן

הערות/מטרה

סטטוסים: Draft → Submitted → Approved/Rejected → Ready for Pickup → Handed Over → Returned/Closed (+ Overdue)

3.6 חתימות (Signatures)

בעת מסירה/החזרה חייבים:

“חתימה” דיגיטלית (שם + אישור + timestamp + מזהה מכשיר/משתמש)

אפשר גם PIN קצר או “אישור במסך” (בלי גרפיקה) בהתאם למדיניות.

4) מסכים (UX) – דגש על המפקדה והמחלקות
4.1 מסך התחברות

טלפון + סיסמה

החלפת סיסמה חובה בפעם הראשונה

“שכחתי סיסמה” (נשלט מדיניות – אם מותר)

4.2 מפקדה (דשבורד על)

מטרות: תמונת מצב, חריגים, קיפול בסיס, בקרה.
ווידג׳טים מומלצים:

סה״כ ציוד לפי מחלקה (זמין/בשימוש/באיחור)

בקשות פתוחות לפי מחלקה

“חריגים חמים”: פריטים באיחור, חוסרים, תנועות לא חתומות

חיפוש גלובלי: “איפה ה-אנטנה X?” / “מי מחזיק מקלדת עם Serial…?”

פעולות:

פתיחת תקופה/סגירה (Snapshot התחלה/סוף)

ניהול מחלקות, מפקדים, קטגוריות

דוחות חתימות + Export (PDF/CSV) לפי הרשאה

4.3 דשבורד מחלקה (למשל קשר – ולרי)

3 טאבים עיקריים:

מלאי מחלקה

רשימת ציוד + זמינות + כפתורים: “הקצאה”, “החזרה”, “העברה”, “קליטה”

בקשות נכנסות

תור בקשות עם פילטרים: מיידי/מתוזמן/דחוף

אישור/דחייה עם הערה

בהשאלה עכשיו

רשימת חיילים + מה מחזיקים + תאריך יעד + מצב (תקין/איחור)

כפתור “שלח תזכורת” (אם מותר באימייל)

4.4 מסך חייל

קטלוג לפי מחלקות/קטגוריות שהוא רשאי לבקש

יצירת בקשה:

בחירת פריט/כמות

בחירת תאריך/שעה (רק אם המחלקה לא מאפשרת “מיידי”)

“הבקשות שלי” עם סטטוס

מסך חתימה בזמן מסירה/החזרה (ביחד עם מפקד המחלקה על אותו מסך)

4.5 מסך קליטה (Receiving)

קליטת כמות: “נכנסו 10 מיטות / 15 מכשירי קשר…”

קליטת סריאלי: הוספת יחידות עם Serial/AssetTag

שמירה יוצרת Movement מסוג “קליטה” + מעדכנת זמינות

5) תהליכים (Flows) – מקצה לקצה
5.1 קליטת ציוד בתחילת תעסוקה

סופר אדמין/מפקד מחלקה פותח “תקופה”

קליטת ציוד (כמותי/סריאלי)

נוצרת נקודת פתיחה (Opening Snapshot) לכל ItemType/Unit

מהנקודה הזו – כל שינוי חייב להיות עם Movement

5.2 השאלה “מיידית”

חייל מגיש בקשה “מיידי”

מפקד מחלקה מאשר

במסירה:

בוחרים כמות/יחידה

החייל חותם

המערכת יוצרת Movement “הקצאה”

המלאי זמין יורד

5.3 השאלה “מתוזמנת” לפי שעות פעילות

המחלקה מגדירה שעות פעילות + האם מותר מיידי או רק מראש

חייל בוחר תאריך ושעה בהתאם לחלונות פתוחים

המפקד מאשר/מציע שעה חלופית

ביום האיסוף – מסירה + חתימה

5.4 החזרה / זיכוי

המפקד פותח מסך “החזרה”

בוחר פריט/יחידה + מאמת שזה אותו חייל/אותה השאלה

החייל חותם שהחזיר

Movement “החזרה” + המלאי זמין עולה

5.5 קיפול בסיס (סגירה)

מעבר מצב בסיס ל-“קיפול”

המפקדה רואה דוח:

מה היה בפתיחה

מה קיים בפועל במחסן

מה עדיין אצל חיילים / איחורים

“רשימת קריאה” אוטומטית: מי מחזיק מה (טלפון/מייל)

בסוף: Closing Snapshot + דוח חריגים חתום.

6) תרחישים קדימה (חשיבה עתידית)
6.1 פריט ש”נעלם”

סימון “חריג/אובדן” דורש:

סיבה

אישור סופר אדמין

Movement מיוחד + מופיע בדוח חריגים

6.2 העברה בין מחלקות

למשל אנטנות עוברות מקשר ללוגיסטיקה:

Movement “Transfer”

חתימה של מוסר + מקבל (שני צדדים)

6.3 ציוד קריטי עם מגבלות

פריטים מסוימים דורשים:

אישור כפול (מפקד מחלקה + מפקדה)

תוקף השאלה קצר

החזרה חובה עד זמן מסוים

6.4 הזמנה חלקית

מבקשים 20 אנטנות, יש רק 12:

אפשר “אישור חלקי” + הצעה להשלמה עתידית

6.5 תקלות/תחזוקה

למחלקת רכב:

בקשה “טיפול” לא מיידית

סטטוס “בביצוע”

תיעוד מי קיבל, מתי צפוי להשתחרר

7) דרישות לא־פונקציונליות (ביצועים, אבטחה, תיעוד)
7.1 ביצועים – לפי “מהיר כמו PHP”

80%+ Server Components לכל עמודי ליבה (דשבורדים, רשימות, פרטים, דוחות).

"use client" רק ל:

חיפוש/פילטרים עם Debounce

תפריט מובייל

חתימה/אישור במסך (קומפוננטה קטנה)

Server Actions לכל כתיבה (קליטה/אישור/מסירה/החזרה).

Prefetch בלינקים ברשימות (Next Link) + טעינה מהירה במעבר מסכים.

Streaming: דשבורד מפקדה נטען כבלוקים (חריגים קודם, רשימות אחר כך).

Caching:

רשימות מלאי למחלקה: cache קצר (למשל 10–30 שניות) + revalidate על שינוי

דוחות: cache לפי פרמטרים + יצירה מחדש לפי צורך

7.2 DB

Neon Postgres + pooling

טבלאות עם אינדקסים על:

department_id

item_type_id

holder_user_id

status

created_at

7.3 אבטחה ותיעוד

Audit Log בלתי מחיק (או “Soft delete” בלבד)

הרשאות לפי תפקיד + מחלקה (Row Level Security אופציונלי בהמשך)

נעילת פעולות רגישות: גריעה/אובדן/העברה בין מחלקות

כל חתימה מחייבת:

user_id, timestamp, action_id, device/session identifier

8) שדות המוצר (כפי שביקשת) + הרחבה מומלצת
חובה

שם מוצר

מס״ב/צ׳ (מזהה)

הערות

קטגוריה/מחלקה

מומלץ להוסיף (כדי למנוע כאב ראש אחר כך)

סוג: כמותי / סריאלי

כמות פתיחה (נשמר בסנאפשוט)

מינימום התראה (כדי להתריע כשנשאר מעט)

“דורש אישור כפול” (כן/לא)

----


1) סוגי משתמשים (Roles)
A) מנהל מערכת – סופר אדמין

שם: יוגב אביטן

טלפון (זיהוי): 0542284283

אימייל: itadmit@gmail.com

הרשאה: FULL SYSTEM (כל הבסיס, כל המחלקות, כל הדוחות, כל ההגדרות)

B) מפקד מפקדה

שם: ניסם חדד

טלפון (זיהוי): 0527320191

הרשאה: גישה רוחבית לבסיס + גישה לאזור “סופר אדמין” (אבל עם יכולות מוגדרות – ראה בהמשך)

C) מפקד מחלקה

לכל מחלקה ניתן להגדיר מפקד (אחד או יותר לפי צורך).

רואה ומנהל רק ציוד/בקשות/השאלות של המחלקה שלו.

D) חייל רגיל

מגיש בקשות, רואה רק את הבקשות שלו, חותם על קבלה/החזרה.

2) חוק הגישה המרכזי: “אזור סופר אדמין” (Admin Console)

במערכת יש אזור ניהול עליון (Super Admin Area) שאליו יכולים להיכנס רק שני תפקידים:
✅ סופר אדמין (יוגב)
✅ מפקד מפקדה (ניסם)
❌ מפקדי מחלקות / חיילים – אין גישה בכלל (אפילו לא קישור / לא דרך URL)

איך זה נראה בפועל במערכת

יש /super-admin (או /hq-admin) שמוגן ב-Role Guard.

בתפריט הצדדי: הקישור מופיע רק למי שיש הרשאה.

גם אם מישהו ינסה להיכנס ידנית לכתובת → יקבל 403 / Redirect.

3) חלוקת סמכויות בתוך “אזור סופר אדמין”

כדי שיהיה מסודר ולא “כולם הכל”, מומלץ:

3.1 סופר אדמין (יוגב) – הכל

ניהול בסיסים/תקופות/סגירה

יצירה/מחיקה/עריכת מחלקות

יצירה/ניהול משתמשים (כולל מפקד מפקדה)

שינוי הרשאות/תפקידים

הגדרות מערכת (שעות פעילות, מדיניות חתימות, מדיניות “מיידי/מראש”, תבניות)

דוחות על + ייצוא

3.2 מפקד מפקדה (ניסם) – ניהול תפעולי על (מומלץ)

צפייה רוחבית בכל המחלקות והציוד

דוחות חריגים (חוסרים, איחורים, ציוד קריטי)

מעקב קיפול בסיס: “מי מחזיק מה”

יכול ליצור/לשייך מפקדי מחלקות (אבל לא ליצור סופר אדמינים)

שינוי מדיניות תפעולית (שעות פעילות למחלקות, מיידי/מראש) – אם תרצה

אם אתה רוצה שניסם יהיה “כמעט סופר אדמין” – אפשר, אבל עדיין נשמור:
סופר אדמין יחיד = רק יוגב.

4) ניהול משתמשים לפי טלפון (כמו שביקשת)

טלפון = מזהה התחברות (Username)

סיסמה ברירת מחדל = הטלפון (ובהתחברות ראשונה חובה שינוי)

לכל משתמש:

שם פרטי, שם משפחה

טלפון

אימייל (אופציונלי)

תפקיד (Role)

שיוך מחלקה (רק למפקד מחלקה/חייל)

5) הרשאות (Rule Matrix קצר)

חייל: בקשה + חתימה + צפייה עצמי בלבד

מפקד מחלקה: ניהול מלאי מחלקתי + אישור בקשות + מסירה/החזרה עם חתימות

מפקד מפקדה: צפייה וניהול רוחבי + דוחות + קיפול בסיס + ניהול מפקדי מחלקות (לפי מה שתבחר)

סופר אדמין: הכל כולל הגדרות מערכת/הרשאות/תשתית


